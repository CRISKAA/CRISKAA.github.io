<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      LCA（最近公共祖先） | Criska 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="criska">
    
    

    <meta name="description" content="LCA模板1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include&amp;lt;iostream&amp;gt;#include&amp;lt;cstdio&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="LCA（最近公共祖先） | Criska">
<meta property="og:url" content="http://yoursite.com/2016/10/14/LCA/index.html">
<meta property="og:site_name" content="Criska">
<meta property="og:description" content="LCA模板1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include&amp;lt;iostream&amp;gt;#include&amp;lt;cstdio&amp;g">
<meta property="og:updated_time" content="2016-11-15T07:31:28.760Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LCA（最近公共祖先） | Criska">
<meta name="twitter:description" content="LCA模板1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include&amp;lt;iostream&amp;gt;#include&amp;lt;cstdio&amp;g">
    
    
    
      <link rel="icon" type="image/x-icon" href="/2.ico">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Criska</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">LCA（最近公共祖先）</h1>

    

    <div class="post-meta">
      <time datetime="2016-10-14" class="post-meta__date date">2016-10-14</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/LCA/">LCA</a>
            </font>
          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/LCA/">LCA</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="LCA模板"><a href="#LCA模板" class="headerlink" title="LCA模板"></a><a href="https://www.luogu.org/problem/show?pid=3379" target="_blank" rel="external">LCA模板</a></h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1000010</span>;</div><div class="line"><span class="keyword">int</span> n,m,s,tope,head[N],f[N][<span class="number">20</span>],log2n,dep[N];</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">struct</span> node&#123;</div><div class="line">	<span class="keyword">int</span> to,next;</div><div class="line">&#125;e[N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">intt</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	tope++;</div><div class="line">	e[tope].to=y;</div><div class="line">	e[tope].next=head[x];</div><div class="line">	head[x]=tope;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[x],y=e[i].to;i;i=e[i].next,y=e[i].to)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(f[x][<span class="number">0</span>]==y) <span class="keyword">continue</span>;</div><div class="line">		f[y][<span class="number">0</span>]=x;</div><div class="line">		dep[y]=dep[x]+<span class="number">1</span>;</div><div class="line">		dfs(y);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">log2</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> r;</div><div class="line">	<span class="keyword">for</span>(r=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;r)&lt;=x;++r);</div><div class="line">	<span class="keyword">return</span> r<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(dep[x]&lt;dep[y]) swap(x,y);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=log2n;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(dep[f[x][i]]&gt;=dep[y])</div><div class="line">			x=f[x][i];</div><div class="line">	<span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=log2n;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(f[x][i]!=f[y][i])</div><div class="line">		&#123;</div><div class="line">			x=f[x][i];</div><div class="line">			y=f[y][i];</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">return</span> f[x][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;m,&amp;s);</div><div class="line">	dep[s]=<span class="number">1</span>;</div><div class="line">	log2n=log2(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</div><div class="line">		intt(x,y);</div><div class="line">		intt(y,x);</div><div class="line">	&#125;</div><div class="line">	dfs(s);</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=log2n;++i)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</div><div class="line">			f[j][i]=f[f[j][i<span class="number">-1</span>]][i<span class="number">-1</span>];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</div><div class="line">		<span class="keyword">int</span> l=lca(x,y);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,l);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="【例题】过路费"><a href="#【例题】过路费" class="headerlink" title="【例题】过路费"></a>【例题】过路费</h1><p>【问题描述】</p>
<p>在某个遥远的国家里，有 n个城市。编号为 1,2,3,…,n。这个国家的政府修<br>建了m 条双向道路，每条道路连接着两个城市。政府规定从城市 S 到城市T需<br>要收取的过路费为所经过城市之间道路长度的最大值。如：A到B长度为 2，B<br>到C 长度为3，那么开车从 A经过 B到C 需要上交的过路费为 3。<br>佳佳是个做生意的人，需要经常开车从任意一个城市到另外一个城市，因此<br>他需要频繁地上交过路费，由于忙于做生意，所以他无时间来寻找交过路费最低<br>的行驶路线。然而， 当他交的过路费越多他的心情就变得越糟糕。 作为秘书的你，<br>需要每次根据老板的起止城市，提供给他从开始城市到达目的城市，最少需要上<br>交多少过路费。 </p>
<p>【输入文件】 </p>
<p>   第一行是两个整数 n 和m，分别表示城市的个数以及道路的条数。<br>   接下来 m 行，每行包含三个整数  a，b，w（1≤a，b≤n，0≤w≤10^9），表示<br>a与b之间有一条长度为 w的道路。<br>   接着有一行为一个整数 q，表示佳佳发出的询问个数。<br>   再接下来 q行，每一行包含两个整数 S，T（1≤S,T≤n，S≠T）,  表示开始城<br>市S 和目的城市T。   </p>
<p>【输出文件】 </p>
<p>输出文件共q行，每行一个整数，分别表示每个询问需要上交的最少过路费<br>用。输入数据保证所有的城市都是连通的。 </p>
<hr>
<ul>
<li>即为给定任意点对，求所有两点之间可连接两点的路径中的最大边最小值。二分的思想是显而易见的，但是只能得30分。</li>
<li><p>仔细分析一下题目，会发现如果要任意两点之间的路径中最大边最小，整个图便符合了最小生成树性质！！<br>证明如下：<br> 若存在从a到b的一条比最小生成树上连接a与b的所经过路径上边更小的边c，则将c加入最小生成树中可得到一个更小的生成树，这显然不符合最小生成树的定义，故不存在这样的边c。<br>其实最小生成树克鲁斯卡尔算法的思想就是按照选择两点之间权值最小的边来构建的。</p>
</li>
<li><p>大概算法就出来了，读入数据，克鲁斯卡尔算法求最小生成树，但这时会发现一个严重问题：怎样处理询问？n的范围过大，dist[n][n]无法存储，枚举根节点来dfs求到任意节点的答案，则算法时间上升到O(n^2)，只能得30分。再分析一下，对于一棵以任一结点为根的已经建好的最小生成树，此时询问无非是两种情况 1：两个节点为直系祖先关系，可直接求得解。2：两个节点为不同分枝上的节点。求这两个节点的答案难以相出好办法。但可以知道两个节点之间只存在唯一一条简单路径，这条唯一简单路径上的变的最大值即为答案，且这两个结点的最近公共最先必然在这一点上。想到可以转化为LCA算法，dfs一边，当处理完当前节点所有的子节点后开始回答关于这个节点的问题。</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">200000</span>;</div><div class="line"><span class="keyword">int</span> tot,k,father[N],n,m,f[N][<span class="number">20</span>],log2n;</div><div class="line"><span class="keyword">int</span> tope,head[N],dep[N],cost[N];</div><div class="line"></div><div class="line"><span class="keyword">struct</span> node&#123;</div><div class="line">	<span class="keyword">int</span> xx,yy,zz;</div><div class="line">&#125;c[N];</div><div class="line"></div><div class="line"><span class="keyword">struct</span> node1&#123;</div><div class="line">	<span class="keyword">int</span> next,to,w;</div><div class="line">&#125;e[N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">intt</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span></div><div class="line">&#123;</div><div class="line">	tope++;</div><div class="line">	e[tope].next=head[x];</div><div class="line">	e[tope].to=y;</div><div class="line">	e[tope].w=z;</div><div class="line">	head[x]=tope;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> node &amp; a,<span class="keyword">const</span> node &amp; b)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> a.zz&lt;b.zz;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fa</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(father[x]!=x)</div><div class="line">	father[x]=fa(father[x]);</div><div class="line">	<span class="keyword">return</span> father[x];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">un</span><span class="params">(<span class="keyword">int</span> r1,<span class="keyword">int</span> r2)</span></span></div><div class="line">&#123;</div><div class="line">	father[r2]=r1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[x],y=e[i].to;i;i=e[i].next,y=e[i].to)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(f[x][<span class="number">0</span>]==y) <span class="keyword">continue</span>;<span class="comment">//shuang xiang bian fang zhi sou hui qu haha</span></div><div class="line">		f[y][<span class="number">0</span>]=x;</div><div class="line">		dep[y]=dep[x]+<span class="number">1</span>;</div><div class="line">		cost[y]=e[i].w;</div><div class="line">		dfs(y);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">log2</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> r;</div><div class="line">	<span class="keyword">for</span>(r=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;r)&lt;=x;++r);</div><div class="line">	<span class="keyword">return</span> r<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(dep[x]&lt;dep[y]) swap(x,y);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=log2n;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(dep[f[x][i]]&gt;=dep[y])</div><div class="line">			x=f[x][i];</div><div class="line">	<span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=log2n;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(f[x][i]!=f[y][i])</div><div class="line">		&#123;</div><div class="line">			x=f[x][i];</div><div class="line">			y=f[y][i];</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">return</span> f[x][<span class="number">0</span>];</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	freopen(<span class="string">"cost.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"cost.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);	</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y,z;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</div><div class="line">		c[i].xx=x;c[i].yy=y;c[i].zz=z;</div><div class="line">	&#125;</div><div class="line">	k=<span class="number">0</span>;</div><div class="line">	log2n=log2(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		father[i]=i;</div><div class="line">	sort(c+<span class="number">1</span>,c+m+<span class="number">1</span>,comp);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x=c[i].xx,y=c[i].yy,z=c[i].zz;</div><div class="line">		<span class="keyword">int</span> r1=fa(x),r2=fa(y);</div><div class="line">		<span class="keyword">if</span>(r1!=r2)</div><div class="line">		&#123;</div><div class="line">			un(r1,r2);</div><div class="line">			intt(x,y,z);</div><div class="line">			intt(y,x,z);</div><div class="line">			k++;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(k==n<span class="number">-1</span>) <span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=log2n;++j)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">			f[i][j]=f[f[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</div><div class="line">	<span class="keyword">int</span> q;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=q;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y,ans=<span class="number">0</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</div><div class="line">		<span class="keyword">int</span> fa=lca(x,y);</div><div class="line">		<span class="keyword">while</span>(x!=fa)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(ans&lt;cost[x]) ans=cost[x];</div><div class="line">			x=f[x][<span class="number">0</span>];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">while</span>(y!=fa)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(ans&lt;cost[y]) ans=cost[y];</div><div class="line">			y=f[y][<span class="number">0</span>];</div><div class="line">		&#125;	</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);	</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="【例题】货车运输"><a href="#【例题】货车运输" class="headerlink" title="【例题】货车运输"></a><a href="https://www.luogu.org/problem/show?pid=1967" target="_blank" rel="external">【例题】货车运输</a></h1><ul>
<li>超级坑爹的例题……哭晕……调了一个晚上……LCA不难理解，但是当加上最小生成树和倍增和其他balabala的东西时就会特别难调，所以要有（可能永远也调不出的）思想准备和越挫越勇的耐心。</li>
<li>以上都是我在胡说八道，其实这道题和上一个例题挺像的，但是有一点点不一样（我到最后才发现╭(╯^╰)╮），给个忠告，<strong>认真审题</strong>。</li>
</ul>
<p>附上垃圾代码<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500010</span>;</div><div class="line"><span class="keyword">int</span> n,m,s,tope,head[N],f[N][<span class="number">30</span>],dep[N],nn,fa[N],cost[N];</div><div class="line"></div><div class="line"><span class="keyword">struct</span> node&#123;</div><div class="line">	<span class="keyword">int</span> to,next,w;</div><div class="line">	<span class="keyword">int</span> xx,yy,zz;</div><div class="line">&#125;e[N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(x!=fa[x]) fa[x]=find(fa[x]);</div><div class="line">	<span class="keyword">return</span> fa[x];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> node &amp; a,<span class="keyword">const</span> node &amp; b)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> a.zz&gt;b.zz;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">un</span><span class="params">(<span class="keyword">int</span> r1,<span class="keyword">int</span> r2)</span></span></div><div class="line">&#123;</div><div class="line">	fa[r2]=r1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">intt</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span></div><div class="line">&#123;</div><div class="line">	tope++;</div><div class="line">	e[tope].to=y;</div><div class="line">	e[tope].next=head[x];</div><div class="line">	e[tope].w=z;</div><div class="line">	head[x]=tope;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[x],y=e[i].to;i;i=e[i].next,y=e[i].to)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(f[x][<span class="number">0</span>]==y) <span class="keyword">continue</span>;</div><div class="line">		f[y][<span class="number">0</span>]=x;</div><div class="line">		dep[y]=dep[x]+<span class="number">1</span>;</div><div class="line">		cost[y]=e[i].w;</div><div class="line">		dfs(y);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">log2</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> r;</div><div class="line">	<span class="keyword">for</span>(r=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;r)&lt;=x;++r);</div><div class="line">	<span class="keyword">return</span> r<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(dep[a]&lt;dep[b]) swap(a,b);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nn;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(dep[f[a][i]]&gt;=dep[b])</div><div class="line">			a=f[a][i];</div><div class="line">	<span class="keyword">if</span>(a==b) <span class="keyword">return</span> a;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nn;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(f[a][i]!=f[b][i])</div><div class="line">		&#123;</div><div class="line">			a=f[a][i];</div><div class="line">			b=f[b][i];</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">return</span> f[a][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y,z;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</div><div class="line">		e[i].xx=x;e[i].yy=y;e[i].zz=z;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		fa[i]=i;</div><div class="line">	sort(e+<span class="number">1</span>,e+m+<span class="number">1</span>,comp);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x=e[i].xx,y=e[i].yy,z=e[i].zz;</div><div class="line">		<span class="keyword">int</span> r1=find(x),r2=find(y);</div><div class="line">		<span class="keyword">if</span>(r1!=r2)</div><div class="line">		&#123;</div><div class="line">			un(r1,r2);</div><div class="line">			intt(x,y,z);</div><div class="line">			intt(y,x,z);</div><div class="line">			k++;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//if(k==n-1) break;</span></div><div class="line">	&#125;</div><div class="line">	<span class="comment">//dep[1]=1;</span></div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	nn=log2(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=nn;++i)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</div><div class="line">			f[j][i]=f[f[j][i<span class="number">-1</span>]][i<span class="number">-1</span>];</div><div class="line">	<span class="keyword">int</span> q;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=q;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> a,b,ans=<span class="number">999999999</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</div><div class="line">		<span class="keyword">int</span> r1=find(a),r2=find(b);</div><div class="line">		<span class="keyword">if</span>(r1!=r2) <span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> ff=lca(a,b);</div><div class="line">			<span class="keyword">while</span>(a!=ff)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">if</span>(ans&gt;cost[a]&amp;&amp;cost[a]!=<span class="number">0</span>) ans=cost[a];</div><div class="line">				a=f[a][<span class="number">0</span>];</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">while</span>(b!=ff)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">if</span>(ans&gt;cost[b]&amp;&amp;cost[b]!=<span class="number">0</span>) ans=cost[b];</div><div class="line">				b=f[b][<span class="number">0</span>];</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="【例题】仓鼠找sugar"><a href="#【例题】仓鼠找sugar" class="headerlink" title="【例题】仓鼠找sugar"></a><a href="https://www.luogu.org/problem/show?pid=3398" target="_blank" rel="external">【例题】仓鼠找sugar</a></h1><blockquote>
<p>垃圾读入优化…………再碰我就剁手<br>改了整整一个多小时，读入优化一去就A了【手动再见】</p>
</blockquote>
<ul>
<li><p>根据题意，我们可以先把不可能相遇的情况判断一下。设p是a,b的LCA，q是c,d的LCA，如果说一对点的LCA的深度比另外一对点中任意一个点的深度都要深的话则不可能相遇，输出N。</p>
</li>
<li><p>然后，如果不满足上面的条件则继续进行判断，我们假设p的深度大于q的深度，那么，如果可能相遇的话（a或b）与（q）的LCA就是q。q的深度大于p的深度的情况亦然。输出Y。</p>
</li>
<li><p>以上情况都不满足的话，输出N。</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">200001</span>;</div><div class="line"><span class="keyword">int</span> tope,head[N],dep[N],f[N][<span class="number">30</span>],n,nn,m,q;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> node&#123;</div><div class="line">	<span class="keyword">int</span> to,next;</div><div class="line">&#125;e[N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">intt</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	tope++;</div><div class="line">	e[tope].to=y;</div><div class="line">	e[tope].next=head[x];</div><div class="line">	head[x]=tope;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[x],y=e[i].to;i;i=e[i].next,y=e[i].to)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(f[x][<span class="number">0</span>]==y) <span class="keyword">continue</span>;</div><div class="line">		f[y][<span class="number">0</span>]=x;</div><div class="line">		dep[y]=dep[x]+<span class="number">1</span>;</div><div class="line">		dfs(y);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">log2</span><span class="params">(<span class="keyword">int</span> x)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> r;</div><div class="line">	<span class="keyword">for</span>(r=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;r)&lt;=x;++r);</div><div class="line">	<span class="keyword">return</span> r<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(dep[a]&lt;dep[b]) swap(a,b);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nn;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(dep[f[a][i]]&gt;=dep[b])</div><div class="line">			a=f[a][i];</div><div class="line">	<span class="keyword">if</span>(a==b) <span class="keyword">return</span> a;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nn;i&gt;=<span class="number">0</span>;--i)</div><div class="line">		<span class="keyword">if</span>(f[a][i]!=f[b][i])</div><div class="line">		&#123;</div><div class="line">			a=f[a][i];</div><div class="line">			b=f[b][i];</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">return</span> f[a][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> x,y;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</div><div class="line">		intt(x,y);</div><div class="line">		intt(y,x);</div><div class="line">	&#125;</div><div class="line">	dep[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	nn=log2(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=nn;++i)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</div><div class="line">			f[j][i]=f[f[j][i<span class="number">-1</span>]][i<span class="number">-1</span>];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=q;++i)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> a,b,c,d;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;a,&amp;b,&amp;c,&amp;d);</div><div class="line">		<span class="keyword">int</span> p,q;</div><div class="line">		p=lca(a,b);</div><div class="line">		q=lca(c,d);</div><div class="line">		<span class="keyword">if</span>(dep[p]&gt;dep[c]&amp;&amp;dep[p]&gt;dep[d])</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"N\n"</span>);</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		&#125; </div><div class="line">		<span class="keyword">if</span>(dep[q]&gt;dep[a]&amp;&amp;dep[q]&gt;dep[b])</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"N\n"</span>);</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(dep[p]&gt;=dep[q])<span class="comment">//x1</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(lca(p,c)==p||lca(p,d)==p) </div><div class="line">			&#123;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"Y\n"</span>);</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(lca(q,a)==q||lca(q,b)==q) </div><div class="line">			&#123;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"Y\n"</span>);</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			&#125;			</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"N\n"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
